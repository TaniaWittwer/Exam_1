---
title: "Delinquence early predictor - longitudinal study"
author: "Tania Wittwer"
output:
  tufte::tufte_handout: default
  tufte::tufte_html: default
---

##Preliminary steps
#Load packages
```{r}
install.packages("pacman")
library(pacman)
p_load(tidyverse, haven, tufte, knitr, magrittr, psych)
```

#Load datafiles
```{r}
delinquency <- read_spss("Cambridge_delinquency_with_caseid.sav")
conviction <- read_spss("conviction_data.sav")
```

#Summary of the data
Donald West and David Farrington collected data of 411 British boys/men of working class area in Cambridge. Data were collected from 1961 to 1981 though different survey and interviews with the boys, parents enven teacher. A the beginning, boys were aged of 8-9 years old. The purpose of the Study was to explore potential predictors of delinquency.


##QUESTION 1
According to the question, we need to select variables which could be "early predictors of criminality". Therefore, I have only choosen variables collected before 10 years old, according the what have been found previously by Krohn (2006) and Kazemian (2011).
Thus, chosen variables as potential predictors are the following (name from the Codebook, with number of the variable): conduct disorder of boy (53), discipline quality of father (62) and mother (63), family size (69), housing - care of interior (83), inconsistency in disagreement between parents (89), interest in education by parents (91), intake time of boy (93), job record of father (96), nervousness of boy (104), number of friends of boy (105), outgoing or withdrawn boy (117), paternal attitude (118), progressive matrices IQ (119), physical neglect of boy (123), peer rating popularity (125), broken home before age 10 (134), sibling disturbance (137), socioeconomic status of family (138), teacher rating: poor attendance (155)
```{r}
predictors_1 <- 
  delinquency %>% 
  select(v4, v53, v62, v63, v69, v83, v89, v91, v93, v96, v104, v105, v117, v118, v119, v123, v125, v134, v137, v138, v155)

predictor_1 <- rename(predictors_1, id = v4, conduct = v53, disc_dad = v62, disc_mum = v63, familysize = v69, housecare = v83, betw_parents = v89, educ_interest = v91, intake = v93, job_dad = v96, nervousness = v104, friends = v105, withdrawn = v117, attitude_dad = v118, iq = v119, phys_neglect = v123, popularity = v125, broken_home = v134, sibl_disturb = v137, socioeco_fam = v138, attendance = v155)
```

In addition, variables on conviction were first selected to create a dichotomous binary variable: convicted vs non-convicted (without taking into account neither the age of conviction(s), nor the number of conviction)
```{r}
#rename to avoid 'variable not found' problem
conviction <- rename(conviction, id = icpsr_seq_id_number)

#make a wide table
conviction_spread <- 
  spread(data = conviction, key = id, value = convicted)

#select only variable containing conviction as adult or juvenile
conviction2a <- conviction_spread[6,]
conviction2b <- conviction_spread[7,]

#make a long table and rename to avoid matching error and for clarity
conviction3a <- 
  gather(conviction2a, key = id, value = agecat) %>% 
  rename(as_adult = agecat)
conviction3b <- 
  gather(conviction2b, key = id, value = agecat) %>% 
  rename(as_juvenile = agecat)

#merge two tables
conviction_merge <- left_join(conviction3a, conviction3b, by = "id")

#create a new binary variable as convicted versus never convicted, resulting on if not convicted as adult (=1) and as juvenile(=1), then not convicted (=1), otherwise convicted (=2)
conviction_merge$convicted <- if_else(conviction_merge$as_adult == 1 & conviction_merge$as_juvenile == 1, 1, 2) 
```

Variable were then merged together in one file
```{r}
#transform id as factor in the predictor datafile
predictor_1$id <- as.factor(predictor_1$id)

#merge
conviction_full <- left_join(predictor_1, conviction_merge, by = "id")
```


##QUESTION 2
Report several (but not too many!) graphs and tables â€“ choose these prudently, and discuss each graph or table you include.  

Because I selected numerous potential predictors, a first look is necessary to know what is worth exploring further. 
```{r}
#transform all variable as factors
#conviction_full <- lapply(conviction_full, as.factor)

#summarise our dataset
describeBy(conviction_full)
```

We can seen that ...
Therefore, the file have been reduced, removing the following variables XX XX XX, and variable hare been renamed
```{r}

```

```{r}

```

##QUESTION 3
We wish to model the occurrence and extent of criminality in our participants on the basis of early life events or factors. Use all the considerations at your disposal (the description above, your data exploration in Question 2, your reading of the articles we have provided, etc.) to construct a statistical model, or even more than one model if you wish.  Interpret your model(s).  Write a function to assess the predictive accuracy of your model(s), test it, and apply it to your data
```{r}

```

